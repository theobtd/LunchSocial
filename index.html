<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Apero Social Sign Up</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f4f4f4;
        }
        .container {
            max-width: 500px;
            margin: auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }
        h1 {
            text-align: center;
        }
        .day {
            border: 1px solid #ccc;
            padding: 10px;
            border-radius: 4px;
            background-color: #fff;
            margin-bottom: 20px;
        }
        .lunch-date {
            margin-top: 5px;
            padding: 5px;
            background-color: #28a745;
            color: white;
            border-radius: 3px;
            text-align: center;
            cursor: pointer;
        }
        .count {
            margin-top: 5px;
            font-size: 0.9em;
            color: #555;
        }
        .thank-you {
            display: none;
            text-align: center;
        }
    </style>
    <script src="https://www.gstatic.com/firebasejs/9.9.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.9.0/firebase-database-compat.js"></script>
</head>
<body>

<div class="container">
    <h1>Apero.Social</h1>
    <div class="day" id="lunchDay">
        <strong>Lunch Dates on <span id="dateLabel"></span></strong>
        <div class="lunch-date" id="lunch1" onclick="showSignupForm('12:00 PM - Lunch at Café Blue')">
            12:00 PM - Lunch at Café Blue
            <div class="count" id="countLunch1">0 signed up</div>
        </div>
        <div class="lunch-date" id="lunch2" onclick="showSignupForm('1:00 PM - Lunch at Deli Fresh')">
            1:00 PM - Lunch at Deli Fresh
            <div class="count" id="countLunch2">0 signed up</div>
        </div>
    </div>

    <div class="thank-you" id="thankYouMessage">
        <p>Thank you for signing up!</p>
    </div>
</div>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyBB61hJK8iHNAXz2q5u8ghGqIFMyJh-Nho",
        authDomain: "aperosocial-d53c7.firebaseapp.com",
        databaseURL: "https://aperosocial-d53c7-default-rtdb.firebaseio.com",
        projectId: "aperosocial-d53c7",
        storageBucket: "aperosocial-d53c7.appspot.com",
        messagingSenderId: "954205055992",
        appId: "1:954205055992:web:c2ebebe1c0ac210163440d"
    };

    const app = firebase.initializeApp(firebaseConfig);
    const database = firebase.database();

    const today = new Date();
    const lunchDate = new Date();
    lunchDate.setDate(today.getDate() + 3); // 3 days from today
    document.getElementById('dateLabel').innerText = lunchDate.toLocaleDateString();

    const lunchDates = {
        '12:00 PM - Lunch at Café Blue': 'lunch1',
        '1:00 PM - Lunch at Deli Fresh': 'lunch2'
    };

    function updateCounts() {
        Object.keys(lunchDates).forEach(lunch => {
            const lunchId = lunchDates[lunch];
            database.ref('users/' + lunch.replace(/ /g, '_')).on('value', snapshot => {
                const count = snapshot.numChildren();
                document.getElementById('count' + lunchId.charAt(0).toUpperCase() + lunchId.slice(1)).innerText = `${count} signed up`;
            });
        });
    }

    function showSignupForm(lunchDetails) {
        const name = prompt("Please enter your name:");
        const email = prompt("Please enter your email:");

        if (name && email) {
            const userData = {
                name: name,
                email: email
            };

            database.ref('users/' + lunchDetails.replace(/ /g, '_')).push(userData)
                .then(() => {
                    document.getElementById('thankYouMessage').style.display = 'block';
                })
                .catch(error => {
                    alert('Error submitting data: ' + error.message);
                });
        }
    }

    // Initialize counts and listeners
    updateCounts();
</script>

</body>
</html>
